---
title: "Your Document Title"
author: "Document Author"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

H20 Es un paquete creado por la compañía [H2O.ai](https://www.h2o.ai/) que busca combinar los principales algoritmos de *machine learning* y aprendizaje estadístico con el *Big Data*. Su forma de comprimir y almacenar los datos permite trabajar con millones de registros (empleando todos sus cores) o un *cluster* de muchos computadores.

```{r results='hide'}
# Import libraries
library(mosaicData)
library(h2o)
```

```{r results='hide', message=FALSE}
# Tablas sencillas
library(tidyverse)
library(kableExtra)
# Tablas páginadas customizadas
library(DT)
# Funcion para obtener datatable (datos, indice tabla, nombre)
custom_dt <- function(data, indice = "n", nombre = "Tabla") {
  table_n <- paste("Table ", indice) 
  dt <- datatable(data,
                  caption = htmltools::tags$caption(
                  style = 'caption-side: bottom; text-align: center;',
                  table_n, htmltools::em(nombre)),
                  extensions = 'FixedColumns',
                  rownames= FALSE,
                  filter = 'top',
                  options = list(
                  pageLength = 5,
                  autoWidth = TRUE,
                  columnDefs = 
                  list(list(width = '300px', targets = c(0,7))),
                  scrollX = TRUE,
                  escape = T)
                  )
  return(dt)
}
```

```{r}

data("SaratogaHouses", package = "mosaicData")
data <- SaratogaHouses
colnames(data)
```

```{r}
head(data)
```

```{r}
colnames(data)
```

```{r}
summary(data)
```

# Conexión a h2o

```{r}
h2o.init(ip = 'localhost',
         nthreads = -1, # -1 indica que se emplean todos los cores disponibles
         max_mem_size = "6g" # Máxima memoria disponible para el cluster
         )
```

```{r}
h2o.removeAll() # Borrar lo que tenía en memoria antes el cluster
```

# Cargar los datos en ambiente h20

```{r}
data_h2o <- as.h2o(x = data, destination_frame = "data_h2o")
```

# Funciones simples ambiente h20

```{r}
h2o.dim(data_h2o)
```

```{r}
h2o.colnames(data_h2o)
```

```{r}
custom_dt(h2o.describe(data_h2o), 1, "h2o describe table")
```

## Mostrar los indices de las columnas numéricas

```{r}
indices_col <- h2o.columns_by_type(data_h20, coltype = "numeric")
indices_col
```

## Nombre de las columnas de indices_col

```{r}
h2o.colnames(data_h2o)[indices_col]
```

## Correlación

```{r}
# [,indices_col] todas las files, solo las columnas numéricas
h2o_cor_df <- h2o.cor(x = data_h2o[,indices_col], y = NULL, method = "Pearson", na.rm = TRUE)

custom_dt(h2o_cor_df, 2, "Correlación de los datos usando h2o")
```

## Tabla con el número de observaciones

```{r}
tabla_conteo_fuel <- as.data.frame(h2o.table(data_h2o$fuel))
# h2o.table Uses the cross-classifying factors to build a table of counts at each combination of factor levels
# Usando as.data.frame lo convierto al ambiente de r
tabla_conteo_fuel
```

## Visualización en ambiente de R (ggplot)

```{r}
tabla_conteo_fuel %>% ggplot(aes(x=fuel, y=Count, fill = fuel)) + geom_col()
```
